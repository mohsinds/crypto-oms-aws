# ============================================================================
# TERRAFORM VARIABLES - COST-OPTIMIZED CONFIGURATION
# ============================================================================
# This is a cost-optimized configuration for development/learning
# Target cost: ~$90-120/month (77% savings from baseline $514/month)
#
# Copy this file to terraform.tfvars and customize for your environment
# DO NOT commit terraform.tfvars to version control (contains sensitive data)
# ============================================================================

# ============================================================================
# PROJECT CONFIGURATION
# ============================================================================

project_name = "crypto-oms"
environment  = "dev"
aws_region   = "us-east-1"

# ============================================================================
# NETWORKING
# ============================================================================

vpc_cidr                 = "10.0.0.0/16"
availability_zones_count  = 2  # Use 2 AZs for dev (cost optimization)
enable_nat_gateway        = false  # DISABLED - Use NAT Instance instead (saves $25/month)
single_nat_gateway        = false  # Not applicable if NAT Gateway disabled
enable_vpc_endpoints      = true  # CRITICAL - Required when NAT Gateway disabled

# ============================================================================
# EKS CONFIGURATION
# ============================================================================
# NOTE: For maximum savings, consider using ECS Fargate instead of EKS
# This saves $72/month (EKS cluster fee). However, this config keeps EKS
# for Kubernetes learning experience.

eks_version              = "1.28"
eks_node_instance_types  = ["t3.small"]  # Smaller instance for dev
eks_node_desired_size    = 1   # Start with 1 node
eks_node_min_size        = 1
eks_node_max_size        = 3
use_spot_instances       = true  # ENABLED - Use Spot instances (saves ~$20/month)

# ============================================================================
# MSK (KAFKA) CONFIGURATION
# ============================================================================
# COST OPTIMIZATION: MSK is the most expensive component ($302/month)
# For maximum savings, disable MSK and use self-hosted Kafka on EC2
# This saves ~$250/month but requires managing Kafka yourself
#
# Option 1: Keep MSK (current) - $302/month
# Option 2: Self-hosted Kafka on EC2 - ~$30/month (recommended for dev)

# CURRENT: MSK Disabled - Use self-hosted Kafka instead
# To enable MSK, uncomment below and comment out self-hosted Kafka section
# kafka_version        = "3.5.1"
# kafka_instance_type   = "kafka.t3.small"
# kafka_broker_count   = 2
# kafka_ebs_volume_size = 50

# Self-hosted Kafka configuration (if MSK disabled)
enable_self_hosted_kafka = true  # Enable self-hosted Kafka on EC2
kafka_instance_type      = "t3.medium"  # EC2 instance for Kafka
kafka_instance_count     = 1  # Single instance for dev (no replication)

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================

redis_node_type       = "cache.t3.micro"  # Dev: ~$12/month (already optimized)
redis_num_cache_nodes = 1  # No replication for dev
redis_engine_version  = "7.0"

# ============================================================================
# DOCUMENTDB CONFIGURATION
# ============================================================================
# COST OPTIMIZATION: DocumentDB costs $50/month
# For maximum savings, use RDS PostgreSQL ($30/month) or self-hosted MongoDB ($15/month)
#
# Option 1: Keep DocumentDB (current) - $50/month
# Option 2: Use RDS PostgreSQL - $30/month (saves $20/month)
# Option 3: Self-hosted MongoDB on EC2 - $15/month (saves $35/month)

# CURRENT: DocumentDB Disabled - Use RDS PostgreSQL instead
# To enable DocumentDB, uncomment below
# documentdb_instance_class = "db.t3.medium"
# documentdb_cluster_size  = 1
# documentdb_engine_version = "5.0.0"

# RDS PostgreSQL configuration (if DocumentDB disabled)
enable_rds_postgresql = true  # Enable RDS PostgreSQL
rds_instance_class    = "db.t3.small"  # Smaller instance
rds_allocated_storage = 20  # GB

# ============================================================================
# SECURITY & ENCRYPTION
# ============================================================================

enable_kms_encryption = true

# ============================================================================
# MONITORING & LOGGING
# ============================================================================

enable_monitoring = true
enable_logging    = true

# ============================================================================
# TAGS
# ============================================================================

tags = {
  Owner      = "Mohsin Rasheed"
  Purpose    = "Learning"
  CostCenter = "Personal"
  CostOptimized = "true"
}

# ============================================================================
# COST ESTIMATE (Cost-Optimized Configuration)
# ============================================================================
# EKS Cluster:        $72/month
# EKS Nodes (Spot):    $9/month (was $30)
# Self-hosted Kafka:   $30/month (was $302 for MSK)
# RDS PostgreSQL:      $30/month (was $50 for DocumentDB)
# ElastiCache:         $12/month
# NAT Instance:        $7/month (was $32 for NAT Gateway)
# ALB:                 $16/month
# Other:               $10/month
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TOTAL:              ~$186/month
#
# ðŸ’¡ FURTHER OPTIMIZATION:
# To get to ~$90/month, replace EKS with ECS Fargate:
# - ECS Fargate: $0 cluster fee (saves $72/month)
# - Final total: ~$114/month
#
# See docs/ARCHITECTURE.md for detailed cost optimization scenarios
# ============================================================================
